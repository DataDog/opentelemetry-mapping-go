<!-- This file is autogenerated. See CONTRIBUTING.md for instructions to add an entry. -->

# Changelog

<!-- next version -->

## v0.28.0

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/inframetadata`: Add support for host aliasing via resource attribute datadog.host.aliases (#661)

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp/metrics`: Fix automatic intial point dropping when converting cumulative monotonic sum metrics (#654)
  This may fix issues with large spikes on Agent/Collector restarts.
  
- `pkg/infradata`: Send host meta on new hosts. (#652)

## v0.27.1

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp/metrics`: Correctly treat summary counts as cumulative monotonic sums instead of cumulative non-monotonic sums (#617)

## v0.27.0

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp`: Convert OTel instrumentation scope attributes to log attributes / metric tags (#598)
  For metrics, the conversion is enabled by the WithInstrumentationScopeMetadataAsTags option.
  

## v0.26.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `all`: Bump required minimum Go version to 1.23 (#517)
- `pkg/otlp/logs`: Add attributes.HostFromAttributesHandler to Translator.MapLogs (#516)
  Impacted functions:|(*Translator).MapLogs

## v0.25.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/otlp/attributes`: Add a new parameter which has a method called when the hostname is resolved (#479)
  Impacted functions:|(*Translator).ResourceToSource|SourceFromAttrs

### ðŸ§° Bug fixes ðŸ§°

- `pkg/quantile`: Improve stability of OTel histogram conversion (#468)

## v0.24.0

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp/metrics`: Fix metric origin mappings from OTel collector receiver instrumentation scope (#466)
- `pkg/otlp/attributes`: Remove HTTP attributes from container tags in OTLP span -> Datadog span mapping (#470)

## v0.23.0

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/attributes`: Add support for mapping OTLP -> DD semantic conventions for HTTP attributes. These mappings are outlined in DD documentation - https://docs.datadoghq.com/opentelemetry/schema_semantics/semantic_mapping/?tab=datadogexporter#http (#426)

## v0.22.0

### ðŸ’¡ Enhancements ðŸ’¡

- `all`: Bump required minimum Go version to 1.22 (#413)

## v0.21.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/otlp/metrics`: Stop prefixing `http_server_duration`, `http_server_request_size` and `http_server_response_size` with `otelcol_` (#406)

## v0.20.0

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/attributes`: Map the new OTel semantic convention `deployment.environment.name` to `env` (#400)
  Mapping of the old convention `deployment.environment` stays the same

## v0.19.0

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: Add `otelcol_` prefix to internal metrics from trace agent (#387)

## v0.18.0

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: Add option that adds prefix to OTEL host metrics (#367)

## v0.17.0

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/attributes`: Adds Kubernetes DD tags to keep when mapping resource attributes. (#334)

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp/logs`: Fix panics on invalid sized trace & span IDs (#340)
- `pkg/otlp/metrics`: Ignore metric datapoints with 'no recorded value' flag (#330)
  - This flag is not supported by Datadog, so we just ignore these datapoints.
  

## v0.16.1

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/attributes`: Adds Kubernetes DD tags to keep when mapping resource attributes. (#334)

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp/metrics`: Ignore metric datapoints with 'no recorded value' flag (#330)
  - This flag is not supported by Datadog, so we just ignore these datapoints.
  

## v0.16.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/otlp/metrics`: Rename metrics origin fields and methods according to new nomenclature. Add OriginProductDatadogExporter value. (#322)

### ðŸ§° Bug fixes ðŸ§°

- `pkg/inframetadata`: Initialize gohai fields on first access to avoid nil pointer dereference (#306)

## v0.15.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/otlp/metrics`: Deprecate the APMStatsConsumer interface and remove it from the Consumer interface. (#320)
  The only breaking change is users can no longer do consumer.(*Consumer).ConsumeAPMStats(), instead they can do consumer.(*APMStatsConsumer).ConsumeAPMStats(). Everything else is backwards-compatible.

## v0.14.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/otlp/metrics`: Remove dead code from mapping-go for older statstoOTLP conversion (#282)

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/attributes`: Make container mapping public (#315)

### ðŸ§° Bug fixes ðŸ§°

- `pkg/inframetadata`: Fixes warning log where resource attributes were not correctly logged (#314)

## v0.13.4

### ðŸ’¡ Enhancements ðŸ’¡

- `inframetadata`: Automatically map `cloud.region`, `cloud.availability_zone` and `cloud.provider` to the `region`, `zone` and `cloud_provider` host tags. (#276)
  - This will only happen if you have opted-in to mapping resource attributes to host metadata.
  

## v0.13.3

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: Adds support for stable JVM metrics introduced in opentelemetry-java-instrumentation v2.0.0. (#265)

## v0.13.2

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp/metric`: Fixes a bug where empty histograms were not being sent to the backend in the distributions mode. (#252)
  - Empty histograms are now mapped as if they had a single (min, max) bucket.
  

## v0.13.1

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: Add kafka metrics mapping. This allows users of the JMX Receiver/JMX Metrics Gatherer and kafka metrics receiver to have access to the OOTB kafka Dashboard. (#239)

## v0.13.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/inframetadata`: Make types in gohai more robust. Fix return type of `Network` method. (#250)

## v0.12.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/inframetadata`: Switch from map[string]string to map[string]any on Gohai getters (#248)
  This prevents a crash when updating the metadata for the host the Collector is running on
  

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/inframetadata`: Resource attributes for deployment environment and cluster name are now automatically added as host tags for the host associated with the resource.  (#233)
- `pkg/inframetadata`: Resource attributes prefixed by `datadog.host.tag.` are now added as host tags for the host associated with the resource.  (#233)
  For example, a resource attribute `datadog.host.tag.foo: bar` will be added as a host tag `foo:bar` for the host associated with the resource.
  
- `pkg/otlp/metrics`: Set metrics origin category, product and service based on the instrumentation scope. (#203)

## v0.11.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/otlp/logs`: Pass `attributes.Translator` explicitly to `logs.Translator` (#231)
- `pkg/otlp/metrics`: Pass `attributes.Translator` explicitly to `metrics.Translator` (#231)
- `pkg/otlp/metrics`: Rename `datadog.otlp_translator.metrics.missing_source` to `datadog.otlp_translator.resources.missing_source` with `signal:metrics` attribute. (#229)

### ðŸš© Deprecations ðŸš©

- `pkg/otlp/attributes`: Deprecate SourceFromAttrs in favor of attributes.Translator (#231)
- `pkg/otlp/logs`: Deprecate `logs.Transform` in favor of `logs.Translator` (#230)

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/inframetadata`: Add support for host.ip and host.mac semantic conventions for host metadata (#225)
- `pkg/otlp/metrics`: Add support for system metrics in host metadata (#184)
  The following metrics are now added as host metadata if present:
  - `system.cpu.physical.count`
  - `system.cpu.logical.count`
  - `system.cpu.frequency`
  - `system.memory.limit`
  

## v0.10.0

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: StatsPayload can now be sent on out channel provided. (#216)

## v0.9.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/metrics`: Remove `WithResourceAttributesAsTags()` and `translatorConfig.ResourceAttributesAsTags` (#219)
- `pkg/otlp/metrics`: Change signature of `NewTranslator` to accept `component.TelemetrySettings` instead of `zap.Logger` (#218)

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/logs`: DataDog log timestamp (ie. '@timestamp') now includes milliseconds. (#152)
- `pkg/otlp/metric`: Add `datadog.otlp_translator.metrics.missing_source` counter, which counts the number of metrics that are missing a source (e.g. hostname). (#220)
- `pkg/inframetadata`: Add support for GOOS and GOARCH values (#185)

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp/metrics`: Removes runtime metric mapping for process.runtime.jvm.gc.duration -> jvm.gc.parnew.time (#213)

## v0.8.3

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/logs`: Add support for nested log attributes. (#207)

## v0.8.2

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: Add support for metrics origin in `Dimensions`. (#204)

## v0.8.1

### ðŸš© Deprecations ðŸš©

- `pkg/otlp/attributes`: ContainerTagFromAttributes is deprecated in favor of ContainerTagFromResourceAttributes. (#193)

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/attributes`: Add support for custom container tags via resource attribute prefix `datadog.container.tag`. (#193)
- `pkg/inframetadata`: Add support for host.cpu resource attributes (#174)

## v0.8.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `all`: Remove go 1.19 support, bump minimum to go 1.20 and add testing for 1.21 (#159)

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp/metrics`: Empty OTLP Exponential Histograms are now dropped instead of causing a crash (#158)

## v0.7.1

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/inframetadata`: Host metadata is now reported the first time new information becomes available for a host. (#150)

## v0.7.0

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp/metrics`: Fix the incorrect for-loop which mutates the same slice while iterating over it, leading to unexpected metric names. Also avoid mutating the input pmetric.Metrics. (#141)
- `pkg/otlp/metrics`: The minimum and maximum estimation for OTLP Histogram to Datadog distribution mapping now ensures the average is within [min, max]. (#149)
  This estimation is only used when the minimum and maximum are not available in the OTLP payload or this is a cumulative payload.
  

## v0.5.5

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp`: Populate OTLP resource attributes in Datadog logs (#138)
- `pkg/otlp/metrics`: Changes mapping for jvm.loaded_classes from process.runtime.jvm.classes.loaded to process.runtime.jvm.classes.current_loaded (#143)

## v0.5.4

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp/logs`: Remove `otel_source` tag from log translator output (#130)

## v0.5.3

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/otlp`: use new location for updated protobuf definitions in the datadog-agent repo, trace protobuf definitions specifically. (#103)
  new definitions include mutext to avoid copies, and so implementations should rely on passing arguments by reference and not value.

## v0.5.2

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/inframetadata`: Add `Reporter` implementation (#88)

## v0.5.1

### ðŸš€ New components ðŸš€

- `pkg/inframetadata`: The pkg/inframetadata module contains logic and payload definitions related to infrastructure monitoring (#105)

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: Add WithInitialCumulMonoValueMode option to metrics translator to configure behavior when exporting cumulative monotonic sums under the 'cumulative_to_delta' mode (#109)

## v0.5.0

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: A new Translator configuration option (WithRemapping) can be used to extract Datadog system and container metrics. (#102)

## v0.4.0

**VERSION HAS BEEN RETRACTED**

## v0.3.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/otlp/metrics`: Renames MapMetrics function return value from `RuntimeMetricsTelemetry` to `Metadata`, renames field `LanguageTags` to `Languages`, and removes field `HasRuntimeMetrics`. (#91)

## v0.2.4

### ðŸš€ New components ðŸš€

- `pkg/otlp/logs`: Create new `pkg/otlp/logs` module for OTLP to DD log translation (#89)

## v0.2.2

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/otlp/metrics`: the MapMetrics method now returns runtime metrics information as well. (#81)

## v0.2.0

### ðŸ›‘ Breaking changes ðŸ›‘

- `pkg/otlp/attributes`: Removed deprecated functions which use preview rules parameter. (#55)
  Full list of removed functions can be found below.
  - [pkg/otlp/attributes] SourceFromAttributes (=> Replaced by SourceFromAttrs)
  - [pkg/otlp/attributes/azure] HostnameFromAttributes (=> Replaced by HostnameFromAttrs)
  - [pkg/otlp/attributes/azure] HostInfoFromAttributes (No replacement)
  - [pkg/otlp/attributes/ec2] HostnameFromAttributes (=> Replaced by HostnameFromAttrs)
  - [pkg/otlp/attributes/gcp] HostnameFromAttributes (=> Replaced by HostnameFromAttrs)
  - [pkg/otlp/attributes/gcp] HostInfoFromAttributes (=> Replaced by HostInfoFromAttrs)
  
- `pkg/otlp/metrics`: Removed deprecated function WithPreviewHostnameFromAttributes. (#55)

### ðŸ§° Bug fixes ðŸ§°

- `pkg/otlp/attributes`: Handle literal 'host' attribute to avoid double tagging. (#65)
  This avoids double tagging when using `metrics::resource_attributes_as_tags` for metrics, or in all cases for traces/logs.

## v0.1.5

### ðŸš© Deprecations ðŸš©

- `pkg/otlp/metrics`: Deprecate and remove usage of WithPreviewHostnameFromAttributes (#48)

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: Use minimum and maximum values from cumulative OTLP Histograms. (#26)
  - Values are used only when we can assume they are from the last time window or otherwise to clamp estimates.

## v0.1.4

### ðŸš© Deprecations ðŸš©

- `pkg/otlp/metrics`: Deprecate metrics.WithCountSumMetrics translator option. (#23)
  - metrics.WithCountSumMetrics will now send min and max metrics when available.
  - Use metrics.WithHistogramAggregations instead.
  

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: Send min and max for delta histograms and delta exponential histograms when metrics.WithHistogramAggregations is used. (#23)

## v0.1.3

### ðŸš© Deprecations ðŸš©

- `pkg/otlp/attributes`: Deprecate and replace functions which have usePreviewRules parameter in preparation to graduate the exporter.datadog.hostname.preview feature gate to stable. (#21)

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: The OTLP metrics converter now maps OpenTelemetry Go runtime metrics to their Datadog counterparts. (#14)

## v0.1.2

### ðŸ’¡ Enhancements ðŸ’¡

- `pkg/otlp/metrics`: The OTLP metrics converter now maps OpenTelemetry Go runtime metrics to their Datadog counterparts. (#14)

## v0.1.1

### ðŸš€ New components ðŸš€

- `pkg/otlp/attributes`: Add new module pkg/otlp/attributes (#9)
- `pkg/otlp/metrics`: Add new module pkg/otlp/metrics (#10)

### ðŸ§° Bug fixes ðŸ§°

- `pkg/quantile`: Handle edge case where total count exceeds sum of bins after conversion from other formats. (#11)
